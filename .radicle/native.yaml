shell: |
  # set PATH to use GHCUP installed GHC
  export PATH=~/.cabal/bin:~/.ghcup/bin:$PATH
  export PATH=~/.radicle/bin:$PATH

  USER=$(id -un)
  HOME=$(getent passwd "$USER" | cut -d: -f6)

  ghc --version
  cabal --version

  ./build.hs

  EXE=$(cabal list-bin sensei-exe)
  HEAD=$(git rev-parse HEAD)

  # restart service only if building master branch
  if git branch --column=never --no-color --contains $HEAD | grep master | tr -d ' ' 2>&1 > /dev/null; then
    [[ -d ${HOME}/.local/bin ]] || mkdir -p ${HOME}/.local/bin
    [[ -f ${HOME}/.local/bin/sensei-exe ]] && rm ${HOME}/.local/bin/sensei-exe
    cp "$EXE" ${HOME}/.local/bin/
    sudo systemctl restart sensei
  fi
